<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Traitors - Multiplayer Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="screen active">
        <div class="screen-content">
            <h1 class="game-title">THE TRAITORS</h1>
            <p class="tagline">Who can you trust?</p>
            <button id="btnPlay" class="btn-primary">PLAY</button>
        </div>
    </div>

    <!-- Name Entry Screen -->
    <div id="nameScreen" class="screen">
        <div class="screen-content">
            <h2>ENTER YOUR NAME</h2>
            <input type="text" id="playerName" class="text-input" placeholder="Your name" maxlength="20">
            <div class="button-group">
                <button id="btnHostGame" class="btn-primary">HOST GAME</button>
                <button id="btnJoinGame" class="btn-secondary">JOIN GAME</button>
            </div>
        </div>
    </div>

    <!-- Host Setup Screen -->
    <div id="hostSetupScreen" class="screen">
        <div class="screen-content">
            <h2>HOST GAME SETUP</h2>
            <div class="game-code-display">
                <p>Game Code:</p>
                <div id="gameCodeDisplay" class="game-code">----</div>
                <p class="help-text">Share this code with other players</p>
            </div>
            
            <div class="setup-options">
                <label for="numTraitors">Number of Traitors:</label>
                <select id="numTraitors" class="select-input">
                    <option value="1">1 Traitor</option>
                    <option value="2">2 Traitors</option>
                    <option value="3">3 Traitors</option>
                </select>
            </div>

            <div class="players-list">
                <h3>Players in Lobby:</h3>
                <div id="lobbyPlayers" class="player-chips"></div>
            </div>

            <div id="startButtonHelp" class="help-text" style="color: #ff6b6b; margin-bottom: 10px;"></div>
            <button id="btnStartGame" class="btn-primary" disabled>START GAME</button>
            <button id="btnCancelHost" class="btn-secondary">CANCEL</button>
        </div>
    </div>

    <!-- Join Game Screen -->
    <div id="joinGameScreen" class="screen">
        <div class="screen-content">
            <h2>JOIN GAME</h2>
            <input type="text" id="gameCodeInput" class="text-input game-code-input" placeholder="----" maxlength="4">
            <p class="help-text" style="margin-top: -10px; margin-bottom: 10px;">Enter 4-letter game code</p>
            <div id="joinStatus" class="status-message"></div>
            <div class="button-group">
                <button id="btnConfirmJoin" class="btn-primary">JOIN</button>
                <button id="btnCancelJoin" class="btn-secondary">CANCEL</button>
            </div>
            <div class="help-text" style="margin-top: 20px;">
                <p><strong>Troubleshooting:</strong></p>
                <p style="font-size: 0.85rem; margin-top: 10px;">‚Ä¢ Make sure the host has created the game</p>
                <p style="font-size: 0.85rem;">‚Ä¢ Check that the 4-letter code is correct</p>
                <p style="font-size: 0.85rem;">‚Ä¢ Both devices need internet connection</p>
            </div>
        </div>
    </div>

    <!-- Waiting Room Screen (for non-host players) -->
    <div id="waitingRoomScreen" class="screen">
        <div class="screen-content">
            <h2>WAITING FOR HOST</h2>
            <div class="game-code-display">
                <p>Game Code:</p>
                <div id="waitingGameCode" class="game-code">----</div>
            </div>
            
            <div class="players-list">
                <h3>Players in Lobby:</h3>
                <div id="waitingPlayers" class="player-chips"></div>
            </div>

            <p class="help-text">Waiting for host to start the game...</p>
            <button id="btnLeaveGame" class="btn-secondary">LEAVE GAME</button>
        </div>
    </div>

    <!-- Role Reveal Screen -->
    <div id="roleRevealScreen" class="screen">
        <div class="screen-content">
            <h2>YOUR ROLE</h2>
            <div class="role-card" id="roleCard">
                <img id="roleImage" src="" alt="Role" class="role-image">
                <h3 id="roleTitle" class="role-title"></h3>
                <p id="roleDescription" class="role-description"></p>
                <div id="traitorsListContainer" class="traitors-list hidden">
                    <h4>Your Fellow Traitors:</h4>
                    <div id="traitorsList"></div>
                </div>
            </div>
            <button id="btnAcknowledgeRole" class="btn-primary">CONTINUE</button>
        </div>
    </div>

    <!-- Main Game Screen -->
    <div id="gameScreen" class="screen">
        <div class="screen-content">
            <div class="game-header">
                <h2>GAME IN PROGRESS</h2>
                <div class="game-stats">
                    <span class="stat">Agents: <strong id="agentCount">0</strong></span>
                    <span class="stat">Traitors: <strong id="traitorCount">0</strong></span>
                </div>
            </div>

            <div class="players-grid" id="playersGrid"></div>

            <div class="game-actions" id="gameActions">
                <!-- Host-only buttons -->
                <div id="hostActions" class="action-section hidden">
                    <button id="btnCallDeliberation" class="btn-action">CALL DELIBERATION</button>
                    <button id="btnRevealMurder" class="btn-action hidden">REVEAL MURDER</button>
                </div>

                <!-- Traitor-only actions -->
                <div id="traitorActions" class="action-section hidden">
                    <button id="btnMurderVote" class="btn-danger hidden">VOTE TO MURDER</button>
                </div>
            </div>

            <div id="timerDisplay" class="timer-display hidden"></div>
        </div>
    </div>

    <!-- Deliberation Screen -->
    <div id="deliberationScreen" class="screen">
        <div class="screen-content">
            <h2>DELIBERATION</h2>
            <p class="help-text">Vote for a player to eliminate</p>
            
            <div id="votingPlayers" class="voting-grid"></div>
            
            <div id="voteStatus" class="vote-status"></div>
            
            <div id="hostDeliberationActions" class="action-section hidden">
                <p class="help-text" style="margin-bottom: 15px;">
                    <strong>Digital Vote:</strong> Wait for all votes, then click "Count Votes"<br>
                    <strong>Paper Vote:</strong> Select player above, then click "Manual Eliminate"
                </p>
                <button id="btnEliminatePlayer" class="btn-danger">COUNT VOTES</button>
                <button id="btnManualEliminate" class="btn-danger" disabled>MANUAL ELIMINATE</button>
                <button id="btnCancelDeliberation" class="btn-secondary">CANCEL</button>
            </div>
        </div>
    </div>

    <!-- Murder Vote Screen (Traitors Only) -->
    <div id="murderVoteScreen" class="screen">
        <div class="screen-content">
            <h2>CHOOSE YOUR VICTIM</h2>
            <p class="help-text traitor-text">Vote for an agent to murder</p>
            
            <div id="murderTargets" class="voting-grid"></div>
            
            <div id="murderVoteStatus" class="vote-status"></div>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="screen">
        <div class="screen-content">
            <h2 id="winnerTitle" class="winner-title">GAME OVER</h2>
            <p id="winnerMessage" class="winner-message"></p>
            
            <div class="final-roles">
                <h3>Final Roles:</h3>
                <div id="finalRolesList"></div>
            </div>

            <button id="btnNewGame" class="btn-primary">NEW GAME</button>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification hidden"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>Connecting...</p>
    </div>

    <!-- Audio Elements -->
    <audio id="bgMusic" loop>
        <source src="assets/Darkambientmusic.mp3" type="audio/mpeg">
    </audio>

    <!-- PeerJS Library -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="script.js"></script>
    
    <!-- Version Number -->
    <div class="version-number">v008</div>
    
    <!-- Help Button (shown on welcome/name screens) -->
    <button id="helpButton" class="help-button" title="Help & Instructions">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
    </button>
    
    <!-- Emergency Reset Button (hidden on welcome screen) -->
    <button id="emergencyReset" class="emergency-reset hidden" title="Reset/Quit Game">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
            <path d="M21 3v5h-5"/>
            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
            <path d="M3 21v-5h5"/>
        </svg>
    </button>
    
    <!-- Reconnect Dialog -->
    <div id="reconnectDialog" class="dialog-overlay hidden">
        <div class="dialog-box">
            <h2>Game In Progress</h2>
            <p id="reconnectMessage" class="dialog-message"></p>
            <div class="dialog-buttons">
                <button id="btnReconnectYes" class="btn-primary">YES</button>
                <button id="btnReconnectNo" class="btn-secondary">NO, START NEW GAME</button>
            </div>
        </div>
    </div>
    
    <!-- Help Screen -->
    <div id="helpScreen" class="screen">
        <div class="screen-content help-content">
            <button id="btnCloseHelp" class="close-help-btn">‚úï</button>
            <h1>THE TRAITORS</h1>
            <h2>How to Play</h2>
            
            <div class="help-section">
                <h3>üéÆ About the Game</h3>
                <p>A real-time multiplayer social deduction game where players use their own devices to play together. Players are secretly assigned as either <strong>Agents</strong> (good) or <strong>Traitors</strong> (bad).</p>
                <ul>
                    <li>Agents must identify and eliminate Traitors through deliberations</li>
                    <li>Traitors can murder Agents and must remain hidden</li>
                    <li>Game ends when all Traitors are eliminated (Agents win) or Traitors equal/outnumber Agents (Traitors win)</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>üöÄ Getting Started</h3>
                <h4>Host a Game:</h4>
                <ol>
                    <li>Enter your name and click "HOST GAME"</li>
                    <li>Share the 4-letter game code with other players</li>
                    <li>Choose number of traitors (must be less than half the players)</li>
                    <li>Click "START GAME" when everyone has joined (need 3+ players)</li>
                </ol>
                
                <h4>Join a Game:</h4>
                <ol>
                    <li>Enter your name and click "JOIN GAME"</li>
                    <li>Enter the 4-letter code from the host</li>
                    <li>Wait for the host to start the game</li>
                </ol>
            </div>
            
            <div class="help-section">
                <h3>üé≠ Role Reveal</h3>
                <p>Each player secretly views their role on their own device:</p>
                <ul>
                    <li><strong class="agent-text">Agents:</strong> See they are an agent</li>
                    <li><strong class="traitor-text">Traitors:</strong> See they are a traitor AND who the other traitors are</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>‚öîÔ∏è Gameplay</h3>
                
                <h4>Deliberations:</h4>
                <ul>
                    <li>The host can call a deliberation at any time</li>
                    <li>All players vote for someone to eliminate</li>
                    <li>The player with the most votes is eliminated and their role is revealed</li>
                    <li>If there's a tie, voting happens again</li>
                </ul>
                
                <h4>Paper Voting:</h4>
                <ul>
                    <li>Host can select a player and click "MANUAL ELIMINATE"</li>
                    <li>Use this for physical paper ballot voting</li>
                </ul>
                
                <h4>Traitor Murders:</h4>
                <ul>
                    <li>10 minutes after each deliberation, traitors can vote to murder an agent</li>
                    <li>All traitors vote secretly</li>
                    <li>The host reveals the murdered player</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>üèÜ Win Conditions</h3>
                <ul>
                    <li><strong class="agent-text">Agents Win:</strong> All traitors are eliminated</li>
                    <li><strong class="traitor-text">Traitors Win:</strong> Traitors equal or outnumber agents</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>üí° Tips</h3>
                <ul>
                    <li><strong>For Agents:</strong> Pay attention to voting patterns and who suggests eliminations</li>
                    <li><strong>For Traitors:</strong> Stay coordinated, spread doubt, and blend in during deliberations</li>
                    <li><strong>Optimal Players:</strong> 5-10 players</li>
                    <li><strong>Traitor Ratio:</strong> 1 traitor per 3-4 players works best</li>
                    <li>Use separate voice chat (Discord, in-person) for deliberations</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>üîß Troubleshooting</h3>
                
                <h4>Can't join game:</h4>
                <ul>
                    <li>Check the game code is correct (4 letters)</li>
                    <li>Make sure host's game is still running</li>
                    <li>Both devices need internet connection</li>
                    <li>Try refreshing both devices</li>
                </ul>
                
                <h4>Connection lost:</h4>
                <ul>
                    <li>Check internet connection</li>
                    <li>Refresh the page (game state is saved)</li>
                    <li>If host disconnected, another player can become host</li>
                </ul>
                
                <h4>Game stuck:</h4>
                <ul>
                    <li>Click the red reset button (top-right)</li>
                    <li>This will quit and restart the game</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>üéØ Features</h3>
                <ul>
                    <li>‚úÖ Real-time multiplayer (3-20 players)</li>
                    <li>‚úÖ Mobile-first design</li>
                    <li>‚úÖ Secret role assignment</li>
                    <li>‚úÖ Digital or paper voting</li>
                    <li>‚úÖ Automatic win detection</li>
                    <li>‚úÖ Game state persists if browser closes</li>
                    <li>‚úÖ Host failover if host disconnects</li>
                </ul>
            </div>
            
            <button id="btnCloseHelpBottom" class="btn-primary" style="margin-top: 20px;">CLOSE</button>
        </div>
    </div>
</body>
</html>
